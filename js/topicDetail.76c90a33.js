(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["topicDetail"],{"298d":function(t,e,r){},5108:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"topic-detail-page"},[r("h2",{staticClass:"is-2 title has-text-centered"},[t._v(t._s(t.detail.title))]),r("p",{staticClass:"is-6 subtitle has-text-centered"},[r("router-link",{attrs:{to:{name:"userPage",params:{uid:t.detail.uid}}}},[t._v(t._s(t.detail.username))]),t._v(","),r("span",[t._v(t._s(t.detail.created_at))])],1),r("div",{staticClass:"content",domProps:{innerHTML:t._s(t.detail.content)}}),r("p",[t.detail.self?r("router-link",{staticClass:"button is-small is-warning",attrs:{to:{name:"topicEdit",params:{tid:t.detail.id}}}},[t._v("编辑")]):t._e()],1),r("div",{staticClass:"divider"}),r("div",{staticClass:"container"},[r("h4",{staticClass:"title is-4"},[t._v("共 "+t._s(t.replys.length)+" 条评论")]),r("section",{staticClass:"replys-container"},t._l(t.replys,function(e){return r("article",{key:e.id,staticClass:"media"},[r("div",{staticClass:"media-left"},[r("figure",{staticClass:"image is-64x64"},[r("img",{attrs:{src:e.avatar}})])]),r("div",{staticClass:"media-content"},[r("p",[r("router-link",{staticClass:"has-text-weight-bold",attrs:{to:{name:"userPage",params:{uid:e.uid}}}},[t._v(t._s(e.username))]),r("small",{staticClass:"tag is-warning is-dateline"},[t._v(t._s(e.created_at))])],1),r("div",{staticClass:"content",domProps:{innerHTML:t._s(e.content)}})])])}))]),r("div",{staticClass:"divider"}),r("div",{staticClass:"content"},[t.isLogin?r("form",{staticClass:"reply-box"},[t._m(0),r("b-field",{attrs:{label:"添加回复",error:t.form.error,type:t.form.type}},[r("b-input",{attrs:{maxlength:"200",type:"textarea"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),r("b-field",[r("a",{staticClass:"button is-primary",on:{click:t.submit}},[t._v("提交")])])],1):r("div",{staticClass:"has-text-centered",staticStyle:{"margin-top":"10px"}},[r("router-link",{staticClass:"is-text is-primary",attrs:{to:{name:"github"}}},[t._v("登录发表评论")])],1)])])},a=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("a",{attrs:{href:"https://guides.github.com/features/mastering-markdown/"}},[r("small",[t._v("Styling with Markdown is supported")])])}],i=(r("96cf"),r("3040")),s=(r("cadf"),r("551c"),r("097d"),r("0fac")),c=r("b510"),u=r("8041"),o={data:function(){return{form:{content:""},detail:{},replys:[],id:""}},computed:{isLogin:function(){return!!this.$store.getters.username}},methods:{getDetail:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(s["a"])(this.id);case 2:e=t.sent,console.log(e),this.$set(this.$data,"detail",e);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getReplys:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["a"])(this.id);case 2:e=t.sent,console.log(e),this.$set(this.$data,"replys",e);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),init:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.$store.dispatch("app/setLoading",!0),t.next=3,this.getDetail();case 3:return t.next=5,this.getReplys();case 5:this.$store.dispatch("app/setLoading",!1);case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),check:function(){return this.form.content?this.form.content.length<5||this.form.content.length>200?(this.form.error="回复内容长度需在 5-200 个字符以内",this.form.type=u["a"].ERROR,!1):(this.form.error="",this.form.type=u["a"].NORMAL,!0):(this.form.error="请输入回复内容",this.form.type=u["a"].ERROR,!1)},submit:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.check(),!e){t.next=16;break}return this.$store.dispatch("app/setLoading",!0),t.next=5,Object(c["c"])(this.detail,this.form.content);case 5:if(r=t.sent,!r){t.next=14;break}return this.form.content="",this.$toast.open({duration:1500,message:"回复成功",position:"is-bottom",type:"is-success"}),t.next=11,this.getReplys();case 11:this.$store.dispatch("app/setLoading",!1),t.next=16;break;case 14:this.$toast.open({duration:1500,message:"回复失败，请重试",position:"is-bottom",type:"is-danger"}),this.$store.dispatch("app/setLoading",!1);case 16:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},mounted:function(){this.id=this.$route.params.id,this.init()}},l=o,d=(r("ffe3"),r("2877")),p=Object(d["a"])(l,n,a,!1,null,"6e3dbf89",null);p.options.__file="detail.vue";e["default"]=p.exports},8041:function(t,e,r){"use strict";r.d(e,"a",function(){return n});var n={ERROR:"is-danger",SUCCESS:"is-success",NORMAL:""}},ac6a:function(t,e,r){for(var n=r("cadf"),a=r("0d58"),i=r("2aba"),s=r("7726"),c=r("32e9"),u=r("84f2"),o=r("2b4c"),l=o("iterator"),d=o("toStringTag"),p=u.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},m=a(f),h=0;h<m.length;h++){var g,v=m[h],b=f[v],y=s[v],w=y&&y.prototype;if(w&&(w[l]||c(w,l,p),w[d]||c(w,d,v),u[v]=p,b))for(g in n)w[g]||i(w,g,n[g],!0)}},b510:function(t,e,r){"use strict";r("ac6a"),r("96cf");var n=r("3040"),a=(r("7514"),r("15fe")),i=a["a"].Object.extend("reply"),s=function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(e){var r,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return r=new a["a"].Query("reply"),t.next=3,r.equalTo("tid",e).addDescending("createdAt").find();case 3:if(n=t.sent,!(n.length>0)){t.next=8;break}return t.abrupt("return",n);case 8:return t.abrupt("return",[]);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),c=function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(e){var r,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return r=new a["a"].Query("reply"),t.next=3,r.equalTo("uid",e).addDescending("createdAt").find();case 3:if(n=t.sent,!(n.length>0)){t.next=8;break}return t.abrupt("return",n);case 8:return t.abrupt("return",[]);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),u=function(t,e){var r=a["a"].User.current();if(!r)return Promise.reject({code:4112});var n=new i;return n.set("content",e),n.set("tid",t.id),n.set("uid",r.id),n.set("username",r.get("username")),n.set("title",t.title),n.save()},o=r("9a1b"),l=r("acdf"),d=r("5a0c"),p=r.n(d),f=r("9b60");r.d(e,"a",function(){return m}),r.d(e,"c",function(){return h}),r.d(e,"b",function(){return g});var m=function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(e){var r,n,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s(e).catch(function(t){return console.error(t),[]});case 2:if(r=t.sent,0!==r.length){t.next=5;break}return t.abrupt("return",[]);case 5:return t.next=7,o["b"](r.map(function(t){return t.get("uid")}));case 7:return n=t.sent,a={},n.forEach(function(t){a[t.id]=t}),t.abrupt("return",r.map(function(t){var e=a[t.get("uid")]||{get:function(){}};return{uid:t.get("uid"),content:f["a"].render(t.get("content")),username:e.get("username"),created_at:p()(t.createdAt).format("YYYY-MM-DD HH:mm"),avatar:e.get("avatar")}}));case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),h=function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(l["a"])(u(e,r)));case 1:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}(),g=function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c(e);case 2:if(r=t.sent,0!==r.length){t.next=5;break}return t.abrupt("return",[]);case 5:return t.abrupt("return",r.map(function(t){return{tid:t.get("tid"),uid:t.get("uid"),content:f["a"].render(t.get("content")),title:t.get("title"),created_at:p()(t.createdAt).format("YYYY-MM-DD HH:mm")}}));case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},ffe3:function(t,e,r){"use strict";var n=r("298d"),a=r.n(n);a.a}}]);
//# sourceMappingURL=topicDetail.76c90a33.js.map